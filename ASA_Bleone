
<!DOCTYPE html> 
<html>

<head>
<meta charset='utf-8' />
<title>Canaux d'irrigation des ASA de la Bl√©one</title>

<!-- Ce code sert √† configurer les param√®tres techniques de la page pour que les accents (√©, √†) s'affichent correctement. Il d√©finit aussi le titre qui appara√Ætra tout en haut sur l'onglet de votre navigateur internet. -->


<link rel="stylesheet" href="reseau_irrig_bleone.css"> <!-- J'appelle le fichier CSS dans le m√™me dossier -->



<script src='https://api.mapbox.com/mapbox-gl-js/v2.4.1/mapbox-gl.js'></script>
<link href='https://api.mapbox.com/mapbox-gl-js/v2.4.1/mapbox-gl.css' rel='stylesheet' />

</head>
<body>
<header>
		<a href='https://iut.univ-amu.fr/fr/formations/licences-professionnelles-desu/lp-cartographie-topographie-systemes-information-geographique'><img src='logo_IUT_blanc_RVB.png' alt='logo_amu' class='logo_amu'></a>
</header>
	
	
		
	<h1>üéÑCanaux d'irrigation des ASA de la Bl√©oneüéÑ</h1>
	
	
	<main>
	<section>

<!-- Ce code connecte la page au moteur Mapbox, ce qui est indispensable pour pouvoir afficher et faire fonctionner la carte interactive par la suite. Il construit √©galement le haut de la page en affichant le logo de l'universit√© et le titre principal du projet sur les canaux d'irrigation. -->


<!-- Initialisation du plugin Geocoder-->

<script src="https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-geocoder/v5.0.0/mapbox-gl-geocoder.min.js"></script>
<link rel="stylesheet" href="https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-geocoder/v5.0.0/mapbox-gl-geocoder.css" type="text/css">

<div id='map' class='map'></div>

<div class='map-overlay-2 top'>
  <div class='map-overlay-inner'>
    <fieldset>
      <label class="categoryLabel">üßë‚ÄçüéÑLP SIG HACKATON 2025üßë‚ÄçüéÑ</label>

	  <div>
        <input type="checkbox" id="bleoneCB" value="bleone" onchange="switchlayer('bleone')"/> 
        <label for="bleoneCB">R√©seaux ASA</label>
      </div>
		<div>
		<input type="checkbox" id="asaCB" value="asa" onchange="switchlayer('asa')"/> 
		<label for="asaCB">ASA</label>
		</div>
	      <div>
	        <input type="checkbox" id="route-bleueCB" value="route-bleue" onchange="switchlayer('route-bleue')"/>
        <label for="route-bleueCB">Route bleue de la Bl√©one</label>
      </div>
      <div>
        <input type="checkbox" id="itineraireCB" value="itineraire" onchange="switchlayer('itineraire')"/>
        <label for="itineraireCB">Itin√©raires PDIPR</label>
      </div>

    </fieldset>

	<fieldset>
			<label class="categoryLabel">üéÅEquipementsüéÅ</label>
            

			<div>
                <input type="checkbox" id="siphCB" value="siph" onchange="switchlayer('siph')"/>
                <label for="siphCB">Siphon</label>
            </div> 
		
			<div>
                <input type="checkbox" id="reglCB" value="regl" onchange="switchlayer('regl')"/>
                <label for="reglCB">R√®gle</label>
            </div>

            <div>
                <input type="checkbox" id="partCB" value="part" onchange="switchlayer('part')"/>
                <label for="partCB">Partiteur</label>
            </div>

		    <div>
                <input type="checkbox" id="pompCB" value="pomp" onchange="switchlayer('pomp')"/>
                <label for="pompCB">Pompe</label>
            </div>  
      
			<div>
                <input type="checkbox" id="martCB" value="mart" onchange="switchlayer('mart')"/>
                <label for="martCB">Marteli√®re</label>
            </div>

			<div>
        		<input type="checkbox" id="degCB" value="deg" onchange="switchlayer('deg')"/>
        		<label for="degCB">D√©grilleur</label>
      		</div>

			<div>
				<input type="checkbox" id="aqCB" value="aq" onchange="switchlayer('aq')"/>
				<label for="aqCB">Aqueduc</label>
			</div>
	  </fieldset>

    <fieldset>
      <label class="categoryLabel">ü´éTopographieü´é</label>
	    <div>
        <input type="checkbox" id="RPGCB" value="RPG" onchange="switchlayer('RPG')"/>
        <label for="RPGCB">Occupation du sol</label>
      </div>
      <div>
        <input type="checkbox" id="hydrologieCB" value="hydrologie" onchange="switchlayer('hydrologie')"/>
        <label for="hydrologieCB">Hydrologie</label>
      </div>
      <div>
        <input type="checkbox" id="Batiments_3DCB" value="Batiments_3D" onchange="switchlayer('Batiments_3D')"/>
        <label for="Batiments_3DCB">B√¢timents 3D</label>
      </div>
    </fieldset>

    <fieldset>
      <label class="categoryLabel">‚òÉÔ∏èFonds de plan‚òÉÔ∏è</label>
	    <div>
        <input type="checkbox" id="orthoCB" value="ortho" onchange="switchlayer('ortho')"/>
        <label for="orthoCB">Image satellite</label>
      </div>
      <div>
        <input type="checkbox" id="cartoCB" value="carto" onchange="switchlayer('carto')"/>
        <label for="cartoCB">Carte</label>
      </div>
    </fieldset>

<fieldset>
                <legend class="legend">Fond de carte</legend>
                <div id="basemap-control" class="basemap-control legend">
                    <select id="basemap-select">
                      <option value="mapbox://styles/mapbox/streets-v11" selected>Streets</option>
                      <option value="mapbox://styles/mapbox/outdoors-v11">Outdoors</option>
                      <option value="mapbox://styles/mapbox/dark-v10">Dark</option>
                      <option value="mapbox://styles/mapbox/satellite-v9">Satellite</option>
                    </select>
                  </div>
            </fieldset>


  </div>
</div>
<!-- Ce code permet d'afficher une carte interactive √©quip√©e d'une barre de recherche pour trouver une adresse. Il cr√©e surtout un menu de contr√¥le qui permet √† l'utilisateur de choisir quelles informations afficher comme les r√©seaux ou les √©quipements, et aussi de pouvoir changer le style du fond de carte. -->


<!-- L√©gende RPG -->
<div id='legend-rpg' class='map-legend' style='display: none'>
  <h4>Occupation du sol RPG</h4>
  <div class='legend-item'>
    <span class='legend-color' style='background-color: #F79B8F;'></span>
    <span>Arboriculture</span>
  </div>
  <div class='legend-item'>
    <span class='legend-color' style='background-color: #EDBB47;'></span>
    <span>C√©r√©ales</span>
  </div>
  <div class='legend-item'>
    <span class='legend-color' style='background-color: #266E3D;'></span>
    <span>Mara√Æchage</span>
  </div>
  <div class='legend-item'>
    <span class='legend-color' style='background-color: #73520B;'></span>
    <span>Ol√©agineux</span>
  </div>
  <div class='legend-item'>
    <span class='legend-color' style='background-color: #C193C9;'></span>
    <span>PAPAM</span>
  </div>
  <div class='legend-item'>
    <span class='legend-color' style='background-color: #9BC993;'></span>
    <span>Prairies</span>
  </div>
</div>
<!-- Ce code cr√©e une l√©gende color√©e qui aide l'utilisateur √† lire la carte en associant une couleur pr√©cise √† chaque type de culture. Il est configur√© pour √™tre cach√© par d√©faut afin de ne s'afficher √† l'√©cran que lorsque l'utilisateur active la couche "Occupation du sol". -->

<script>

mapboxgl.accessToken = 
'pk.eyJ1IjoiZGFibzIyIiwiYSI6ImNremltNXR2aTMxaG0ydW8xYmcwOGU3YjUifQ.33TjJKovMQpZ1dkC0S9K3Q';
// Ce code fournit la cl√© d'acc√®s obligatoire (token) qui permet au site de se connecter aux serveurs de Mapbox. Sans cette ligne, qui agit comme un mot de passe, la carte ne peut pas charger les images ni s'afficher √† l'√©cran.


// Configuration de la carte

// ORTHOPHOTO
var map = new mapboxgl.Map({
container: 'map',
style: 'mapbox://styles/mapbox/satellite-streets-v12',
center: [6.1753, 44.06335],// Coordonn√©e en degr√© d√©cimal 
zoom: 12, // zoom
pitch: 50, // Inclinaison
bearing:31 // Rotation
});
// Ce code g√©n√®re la carte interactive dans la page et lui donne son apparence de d√©part, ici une vue satellite. Il positionne √©galement la cam√©ra pour que la carte s'ouvre pile sur la Bl√©one proche de Digne-les-Bains, avec une inclinaison (pitch) et une rotation (bearing) pour donner un effet 3D.


// Ecouteur du menu Select des fonds de carte
document.getElementById('basemap-select').addEventListener('change', function(e) {
    var newStyle = e.target.value;

    // R√©cup√©ration des param√®tres actuels de la cam√©ra
    var currentCamera = {
        center: map.getCenter(),
        zoom: map.getZoom(),
        pitch: map.getPitch(),
        bearing: map.getBearing()
    };

    // Changer de style
    map.setStyle(newStyle);

    // Une fois le nouveau style charg√©, ce code r√©applique la position de la cam√©ra et recharge toutes les couches
    map.once('style.load', function() {
        map.jumpTo(currentCamera);
        addAllLayers(); // R√©appliquer toutes les couches apr√®s le changement de style
    });
});
// Ce code permet de changer le fond de carte de mani√®re fluide. Son r√¥le crucial est de m√©moriser exactement o√π on regardait (zoom, inclinaison, position) avant le changement pour r√©tablir cette vue imm√©diatement apr√®s. Sans cela, la carte risquerait de se r√©initialiser et se renvoyer au point de d√©part √† chaque changement de style.
	

// *** 1. APPEL DES COUCHES *** //

	// AJout de donnees OSM

// Fonction pour ajouter toutes les couches
function addAllLayers() {
	map.addSource('mapbox-dem', { // D√©finition de la source de donn√©e
				'type': 'raster-dem',
				'url': 'mapbox://mapbox.mapbox-terrain-dem-v1',  // On ajoute le MNE √† notre carte
				'tileSize': 512,
				'maxzoom': 14
			});
     // Ajout du MNE et sp√©cification de l'√©xag√©ration
     map.setTerrain({ 'source': 'mapbox-dem', 'exaggeration': 1.5 }); // On ajoute une exag√©ration de 1.5 pour la rendre r√©aliste, si on veut travailler sans que les ic√¥nes disparaissent, il faut mettre en commentaire ce map.setTerrain
    
	// Ce code transforme la carte plate en une carte en 3D en y ajoutant le relief gr√¢ce √† des donn√©es d'altitude. Il configure aussi une exag√©ration verticale (x1.5) pour que les pentes paraissent plus prononc√©es et le paysage plus lisible √† l'√©cran.


	// Ajout de l'occupation du sol (RPG)
	map.addSource('RPG', { 
		type: 'vector',
		url: 'mapbox://dabo22.b21llohm'}); // Id du tileset de Mapbox
			
		map.addLayer({
		'id': 'RPG', // Donner le nom que l'on souhaite
		'type': 'fill',
		'source': 'RPG', //Donner le nom que l'on souhaite
		'source-layer':'RPG_ASAs_4326-9y53t2',
		'layout': {'visibility': 'none'},
		'paint': {
			'fill-color': [
				'match',
				['get', 'Classeur10'],
				'ARBORICULTURE', '#F79B8F', // Rouge
				'C√âR√âALES', '#EDBB47', // Jaune
				'MARAICHAGE', '#266E3D', // Bleu
				'OL√âAGINEUX', '#73520B', // Vert
				'PAPAM', '#C193C9', // Magenta
				'PRAIRIES', '#9BC993', // Cyan
				'#808080' // Couleur par d√©faut (gris)
				],
			'fill-opacity': 0.6
		}
		});
// Ce code charge les donn√©es des parcelles agricoles (RPG) et les colorie automatiquement selon le type de culture (jaune pour les c√©r√©ales, rouge pour les arbres, etc) gr√¢ce √† une r√®gle de style conditionnelle (match). Il configure cette couche pour qu'elle soit masqu√©e par d√©faut (visibility: none) au chargement de la page, afin de ne pas surcharger la carte tant que l'utilisateur ne l'a pas demand√©e.
		

	// Ajout du p√©rim√®tre des ASA
	map.addSource('asa', {
	type : 'vector',
	url : 'mapbox://dabo22.c1xfg5g8'});

	map.addLayer({
	'id': 'asa',
	'type': 'fill',
	'source': 'asa',
	'source-layer':'perimetre_asa_4326-d6053d',
	'layout': {'visibility': 'none'},
	'paint': {
		'fill-color': [
			'match',
			['get', 'nom'],
			// Remplacez les valeurs ci-dessous par les noms r√©els pr√©sents dans votre champ "nom"
			'ASA du Canal de la Plaine de Gaubert', '#f94144',
			'ASA du canal de la Grande Iscle', '#f3722c',
			'ASA Canal du Nigas', '#90be6d',
			/* valeur par d√©faut */ '#577590'
			],
		'fill-opacity': 0.45,
		'fill-outline-color': '#333333'
	},
	});
	//Ce code ajoute les p√©rim√®tres des ASA sur la carte en coloriant chaque secteur diff√©remment selon son nom pour bien les distinguer visuellement. Il configure aussi leur transparence pour laisser voir le fond de plan et garde ces zones masqu√©es par d√©faut tant que l'utilisateur ne les active pas.


	// Ajout itineraire randos p√©destre, VTT, √©questre au PDIPR
			
	map.addSource('itineraire', { 
	type: 'vector',
	url: 'mapbox://dabo22.cd4kvjsz'}); // Id du tileset de Mapbox
			
	map.addLayer({
	'id': 'itineraire', // Donner le nom que l'on souhaite 
	'type': 'line',
	'source': 'itineraire', // Donner le nom que l'on souhaite 
	'source-layer':'pdipr-7c2ley',
	'layout': {'visibility': 'none', 'line-join': 'round','line-cap': 'round'},
	'paint': {'line-width': 2, 'line-color': 'red',} // line-width et line-color quand le type est line, la couleur est rouge  
	});
	//Ce code ajoute les itin√©raires de randos p√©destres, VTT et √©questre au PDIPR sur la carte en mettant son trac√© en rouge. Il configure aussi leur transparence pour laisser voir le fond de plan et garde ces zones masqu√©es par d√©faut tant que l'utilisateur ne les active pas.


	// Ajout route bleue de la bl√©one
			
	map.addSource('route-bleue', { 
	type: 'vector',
	url: 'mapbox://dabo22.99iasv9y'}); // Id du tileset de Mapbox
			
	map.addLayer({
	'id': 'route-bleue', // Donner le nom que l'on souhaite 
	'type': 'line',
	'source': 'route-bleue', // Donner le nom que l'on souhaite 
	'source-layer':'sentier_touriste-76oftq',
	'layout': {'visibility': 'none', 'line-join': 'round','line-cap': 'round'},
	'paint': {'line-width': 2, 'line-color': 'yellow',} // bien mettre line-width et line-color quand le type est line, la couleur est jaune  
	});
	//Ce code ajoute la route bleue de la bl√©one sur la carte en mettant son trac√© en jaune. Il configure aussi leur transparence pour laisser voir le fond de plan et garde ces zones masqu√©es par d√©faut tant que l'utilisateur ne les active pas.
	

	// Ajout des canaux d'irrigation de la Bl√©one

	map.addSource('bleone', { 
	type: 'vector',
	url: 'mapbox://dabo22.83ztmm3k'}); // Id du tileset de Mapbox 			
	map.addLayer({
	'id': 'bleone', // Donner le nom que l'on souhaite 		
	'type': 'line',
	'source': 'bleone', // Donner le nom que l'on souhaite 
	'source-layer':'canaux_4326-57pv00',
	'layout': {'visibility': 'none', 'line-join': 'round','line-cap': 'round'},
	'paint': {'line-width': 2, 'line-color': [
			'match',
			['get', 'lib_type'],
			'primaire', '#1f77b4',
			'secondaire', '#17becf',
			'souterrain', '#9edae5',
			/* valeur par d√©faut */ '#aec7e8'
	],} // line-width et line-color quand le type est line, la couleur est diff√©rente en fonction du type de canal.
	});
	//Ce code ajoute les canaux d'irrigation de la Bl√©one sur la carte en mettant son trac√© en fonction du type de canal. Il configure aussi leur transparence pour laisser voir le fond de plan et garde ces zones masqu√©es par d√©faut tant que l'utilisateur ne les active pas.


		// *** EQUIPEMENTS ***

		//Equipement des ASA Bl√©one !!!!

	map.addSource('eqpmt', {
    type: 'vector',  // La couche import√©e sera une couche vectorielle //
    url: 'mapbox://dabo22.1xnj4tl8'  // On va chercher la couche des √©quipements sur Mapbox gr√¢ce √† cette URL //
	});

	// Je travaille sur les √©quiments "siphon" ('id'= 'siph') de type 'circle' extraits de la couche "eqpmt" // 
	
	map.addLayer({
    	'id': 'siph',
    	'type': 'circle',
    	'source': 'eqpmt',
    	'source-layer': 'Equip4326-66b30p',
		'filter' : ["all", ["==",'typ_nom','Siphon']],
    	'layout': {
        'visibility': 'none'
    },
    paint: {
        'circle-radius': 6, // Le rayon des cercles repr√©sentant les siphons sera de 6 u (ces caract√©ristiques seront appliqu√©es √† tous les √©quipements => commentaires valables pour tous les autres √©quipements) //
        'circle-opacity': 0.7, //L'opacit√© des cercles sera de 70% //
        'circle-color': [
            'match',
            ['get', 'typ_equip'], // Je d√©finis la couleur de chaque √©quipement //
            'SIPH', '#FF0000',
            'REGL', '#FFFF00',
            'PART', '#0000FF',
            'POMP', '#00FF00',
            'MART', '#FF00FF',
            'DEGR', '#00FFFF',
            'AQUE', '#7A4E4E',
            '#808080'
        ]
    }
	});


// Je travaille sur les √©quiments "r√®gles" ('id'= 'regl') de type 'circle' extraits de la couche "eqpmt" // 
	
	map.addLayer({
    	'id': 'regl',
    	'type': 'circle',
    	'source': 'eqpmt',
    	'source-layer': 'Equip4326-66b30p',
		'filter' : ["all", ["==",'typ_nom','R√®gle']],
    	'layout': {
        'visibility': 'none'
    },
    paint: {
        'circle-radius': 6, 
        'circle-opacity': 0.7,
        'circle-color': [
            'match',
            ['get', 'typ_equip'],
            'SIPH', '#FF0000',
            'REGL', '#FFFF00',
            'PART', '#0000FF',
            'POMP', '#00FF00',
            'MART', '#FF00FF',
            'DEGR', '#00FFFF',
            'AQUE', '#7A4E4E',
            '#808080'
        ]
    }
	});
// Je travaille sur les √©quiments "partiteurs" ('id'= 'part') de type 'circle' extraits de la couche "eqpmt" // 

	map.addLayer({
    	'id': 'part',
    	'type': 'circle',
    	'source': 'eqpmt',
    	'source-layer': 'Equip4326-66b30p',
		'filter' : ["all", ["==",'typ_nom','Partiteur']],
    	'layout': {
        'visibility': 'none'
    },
    paint: {
        'circle-radius': 6,
        'circle-opacity': 0.7,
        'circle-color': [
            'match',
            ['get', 'typ_equip'],
            'SIPH', '#FF0000',
            'REGL', '#FFFF00',
            'PART', '#0000FF',
            'POMP', '#00FF00',
            'MART', '#FF00FF',
            'DEGR', '#00FFFF',
            'AQUE', '#7A4E4E',
            '#808080'
        ]
    }
	});
// Je travaille sur les √©quiments "pompes" ('id'= 'pomp') de type 'circle' extraits de la couche "eqpmt" // 

	map.addLayer({
		'id': 'pomp',
		'type': 'circle',
		'source': 'eqpmt',
		'source-layer': 'Equip4326-66b30p',
		'filter' : ["all", ["==",'typ_nom','Pompe']],
		'layout': {
        'visibility': 'none'
    },
    paint: {
        'circle-radius': 6,
        'circle-opacity': 0.7,
        'circle-color': [
            'match',
            ['get', 'typ_equip'],
            'SIPH', '#FF0000',
            'REGL', '#FFFF00',
            'PART', '#0000FF',
            'POMP', '#00FF00',
            'MART', '#FF00FF',
            'DEGR', '#00FFFF',
            'AQUE', '#7A4E4E',
            '#808080'
        ]
    }
	})
// Je travaille sur les √©quiments "marteli√®res" ('id'= 'mart') de type 'circle' extraits de la couche "eqpmt" // 

		map.addLayer({
		'id': 'mart',
		'type': 'circle',
		'source': 'eqpmt',
		'source-layer': 'Equip4326-66b30p',
		'filter' : ["all", ["==",'typ_nom','Marteli√®re']],
		'layout': {
        'visibility': 'none'
    },
    paint: {
        'circle-radius': 6,
        'circle-opacity': 0.7,
        'circle-color': [
            'match',
            ['get', 'typ_equip'],
            'SIPH', '#FF0000',
            'REGL', '#FFFF00',
            'PART', '#0000FF',
            'POMP', '#00FF00',
            'MART', '#FF00FF',
            'DEGR', '#00FFFF',
            'AQUE', '#7A4E4E',
            '#808080'
        ]
    }
	})
// Je travaille sur les √©quiments "deg" ('id'= 'd√©grilleur') de type 'circle' extraits de la couche "eqpmt" // 

	map.addLayer({
		'id': 'deg',
		'type': 'circle',
		'source': 'eqpmt',
		'source-layer': 'Equip4326-66b30p',
		'filter' : ["all", ["==",'typ_nom','Degrillage']],
		'layout': {
        'visibility': 'none'
    },
    paint: {
      	  'circle-radius': 6,
        'circle-opacity': 0.7,
        'circle-color': [
            'match',
            ['get', 'typ_equip'],
            'SIPH', '#FF0000',
            'REGL', '#FFFF00',
            'PART', '#0000FF',
            'POMP', '#00FF00',
            'MART', '#FF00FF',
            'DEGR', '#00FFFF',
            'AQUE', '#7A4E4E',
            '#808080'
        ]
    }
	})
// Je travaille sur les √©quiments "aqueduc" ('id'= 'aq') de type 'circle' extraits de la couche "eqpmt" // 

	map.addLayer({
		'id': 'aq',
		'type': 'circle',
		'source': 'eqpmt',
		'source-layer': 'Equip4326-66b30p',
		'filter' : ["all", ["==",'typ_nom','Aqueduc']],
		'layout': {
        'visibility': 'none'
    },
    paint: {
        'circle-radius': 6,
        'circle-opacity': 0.7,
        'circle-color': [
            'match',
            ['get', 'typ_equip'],
            'SIPH', '#FF0000',
            'REGL', '#FFFF00',
            'PART', '#0000FF',
            'POMP', '#00FF00',
            'MART', '#FF00FF',
            'DEGR', '#00FFFF',
            'AQUE', '#7A4E4E',
            '#808080'
        ]
    }
	})

	// Ajout des donn√©es OSM
			
	map.addSource('mapbox-streets-v8', { // J'ajoute la source pour afficher dessous les couches des donn√©es OSM 
	type: 'vector', // Les fonds OSM seront de type vecteur //
	url: 'mapbox://mapbox.mapbox-streets-v8'});  // Je vais chercher les fonds OSM en suivant l'URL //
		
		// Configuration de la couche de l'hydrographie

		map.addLayer({"id": "hydrologie", //appel de couche car la source est la m√™me que pour les routes (mapbox-streets-v8) 
		"type": "line", // Couche de type "ligne" //
		"source": "mapbox-streets-v8", // Je d√©finis la source de ma couche //
		"source-layer": "waterway",
		'layout': {'visibility': 'none'},
		"paint": {"line-color": "blue", // Les lignes de la couche seront symbolis√©es en bleu //
		"line-width": 4} // La largeur des lignes sera de 4 u //
		});
			
			
		// Ajout batiments 3D OSM 
		
		map.addLayer({
		'id': 'Batiments_3D', //appel de couche car la source est la m√™me que pour les routes (mapbox-streets-v8)
		'source': 'mapbox-streets-v8',  
		'source-layer': 'building',
		'layout': {'visibility': 'none'},
		'filter': ['==', 'extrude', 'true'],
		'type': 'fill-extrusion', // On extrude les batiments //
		'minzoom': 15, // Le zoom minimal pour voir les b√¢timents 3D est d√©fini √† 15 //
		'paint': {'fill-extrusion-color': '#555555', 'fill-extrusion-height': 
		{'type': 'identity','property': 'height'},
		'fill-extrusion-base': {'type': 'identity','property': 'min_height'},
		'fill-extrusion-opacity': 0.8
		}
		});	
			
		
			 
			// Ajout des b√¢timents 
		
			map.addLayer({
			"id": "batiments", // On ne prend que les √©l√©ments dont l'id est "batiments" //
			"type": "fill", 
			"source": "mapbox-streets-v8",
			"source-layer": "building",
			'layout': {'visibility': 'none'},
			"paint": {"fill-color": "#FEFEFE", // Couleur des b√¢timents d√©finie par le code '#FEFEFE' soit un l√©ger gris*//
			"fill-opacity": 0.8} // L'opacit√© des b√¢timents est de 80% //
			});


		// Configuration de la couche route

		map.addLayer({ //On appel ici la couche de donn√©es des routes issues d‚ÄôOSM 

		"id": "Routes",  // On ne prend que les √©l√©ments dont l'id est "routes" //
		"type": "line",  // Les √©l√©ments seront de type 'ligne' //
		"source": "mapbox-streets-v8",
		"layout": {'visibility': 'none'},
		"source-layer": "road",
		'layout': {'visibility': 'none'},
		"filter": ["all",  ["in", "track", "street"]],   //On peut filtrer uniquement avec l'attribut "filter" les pistes foresti√®res "track" et les petites voies "street", regarder toutes les options dans la doc Mapbox https://docs.mapbox.com/data/tilesets/reference/mapbox-streets-v8/#road
		"paint": {"line-color": "#FF7F50", "line-width": 1} // On d√©finit la couleur des route √† orange selon le code hexad√©cimal #FF7F50 //
		});
			


	// *** 2. FONCTIONS *** //
		
	 switchlayer = function (lname) {	
    if (document.getElementById(lname + "CB").checked) {
        map.setLayoutProperty(lname, 'visibility', 'visible');
        // Affiche la l√©gende RPG si la couche RPG est activ√©e
        if (lname === 'RPG') {
            document.getElementById('legend-rpg').style.display = 'block';
        }
    } else {
        map.setLayoutProperty(lname, 'visibility', 'none');
        // Masque la l√©gende RPG si la couche RPG est d√©sactiv√©e
        if (lname === 'RPG') {
            document.getElementById('legend-rpg').style.display = 'none';
        }
       }
     }
	// Ce code permet de basculer la visibilit√© des couches sur la carte en fonction de l'√©tat des cases √† cocher dans le menu. Il g√®re aussi l'affichage conditionnel de la l√©gende pour l'occupation du sol en la montrant uniquement lorsque cette couche est activ√©e.			
			
			// Geocoder
			const geocoder = new MapboxGeocoder({
			accessToken: mapboxgl.accessToken,
			language: 'fr-FR', // Sp√©cifie le fran√ßais.
			mapboxgl: mapboxgl
			});
			map.addControl(geocoder, 'bottom-right');	
				
		
			// Ajout boutons navigation a la fin du script
			var nav = new mapboxgl.NavigationControl();
			map.addControl(nav, 'top-left');
						
						
			// Ajout Echelle cartographique a la fin du script
			map.addControl(new mapboxgl.ScaleControl({
			maxWidth: 120,
			unit: 'metric'}));
			
			
			//*** 3. INTERACTIVITE UTILISATEUR ***//
			
			//Int√©ractivit√© lors du clic sur la couche des r√©seaux d'irrigation de la Bl√©one
			map.on('click', function (e) { //Evenement au clic sur la couche bleone 
			var features = map.queryRenderedFeatures(e.point, { layers: ['bleone'] });
			if (!features.length) {
			return;
			}
			var feature = features[0];
			var popup = new mapboxgl.Popup({ offset: [0, -15] })
			.setLngLat(e.lngLat)
			.setHTML('<h3>' + feature.properties.lib_type + '</h3>') //Je lui fait afficher la valeur dans le champ nom de mon shp dans le Tileset Mapbox
			.addTo(map);
			});
			//R√©cup√©rer l‚Äôobjet cliqu√© dans la couche, cherche les entit√©s affich√©es exactement sous le clic, mais uniquement dans la couche bleone.
            //Affiche la couche bleone sous le clic, r√©cup√®re sa propri√©t√© lib_type et l‚Äôaffiche dans une popup positionn√©e √† l‚Äôendroit exact du clic

			// Interactivit√© au survol de la couche des r√©seaux d'irrigation de la Bl√©one (affiche le type de canal)
			var bleoneHoverPopup = new mapboxgl.Popup({ closeButton: false, closeOnClick: false });
			map.on('mouseenter', 'bleone', function() {
				map.getCanvas().style.cursor = 'pointer';
			});
			map.on('mouseleave', 'bleone', function() {
				map.getCanvas().style.cursor = '';
				bleoneHoverPopup.remove();
			});
			map.on('mousemove', 'bleone', function(e) {
				var feature = e.features && e.features[0];
				if (!feature) { bleoneHoverPopup.remove(); return; }
				var name = feature.properties && feature.properties.lib_type ? feature.properties.lib_type : 'ASA';
				bleoneHoverPopup.setLngLat(e.lngLat)
					.setHTML('<strong>' + name + '</strong>')
					.addTo(map);
			});
			//Lors du clic sur les couches r√©seaux d'irrigations, cela affiche les noms instantan√©ment dans l'infobulle et la bulle dispara√Æt d√®s que la souris s'√©loigne. 

			
			// Interactivit√© au survol de la couche ASA (affiche le nom)
			var asaHoverPopup = new mapboxgl.Popup({ closeButton: false, closeOnClick: false });
			map.on('mouseenter', 'asa', function() {
				map.getCanvas().style.cursor = 'pointer';
			});
			map.on('mouseleave', 'asa', function() {
				map.getCanvas().style.cursor = '';
				asaHoverPopup.remove();
			});
			map.on('mousemove', 'asa', function(e) {
				var feature = e.features && e.features[0];
				if (!feature) { asaHoverPopup.remove(); return; }
				var name = feature.properties && feature.properties.nom ? feature.properties.nom : 'ASA';
				asaHoverPopup.setLngLat(e.lngLat)
					.setHTML('<strong>' + name + '</strong>')
					.addTo(map);
			});
			//Lors du clic SUR les different ASA le script r√©cup√®re la premi√®re entit√© sous la souris, lit la propri√©t√© et positionne le popup √† la position du pointeur. Cela affiche au final le nom en gras dans le popup.

			// Interactivit√© au survol de la couche RPG (affiche Classeur10)
			var RPGHoverPopup = new mapboxgl.Popup({ closeButton: false, closeOnClick: false });
			map.on('mouseenter', 'RPG', function() {
				map.getCanvas().style.cursor = 'pointer';
			});
			map.on('mouseleave', 'RPG', function() {
				map.getCanvas().style.cursor = '';
				RPGHoverPopup.remove();
			});
			map.on('mousemove', 'RPG', function(e) {
				var feature = e.features && e.features[0];
				if (!feature) { RPGHoverPopup.remove(); return; }
				var name = feature.properties && feature.properties.Classeur10 ? feature.properties.Classeur10 : 'type';
				RPGHoverPopup.setLngLat(e.lngLat)
					.setHTML('<strong>' + name + '</strong>')
					.addTo(map);
			});
			// Au clique sur la couche RPG, cela place le popup √† l‚Äôendroit o√π est la souris, met comme texte dedans, la valeur du RPG, √©crit en gras, puis montre le popup sur la carte.


			// --- R√©initialiser les checkboxes au chargement de la page
			function resetCheckboxes() {
				var cbs = document.querySelectorAll('.map-overlay-inner input[type="checkbox"]');
				cbs.forEach(function(cb) {
					try { cb.checked = false; } catch (e) { }
				});

				// Synchroniser la visibilit√© des couches si la carte est pr√™te
				if (typeof map !== 'undefined' && map && typeof map.getLayer === 'function') {
					cbs.forEach(function(cb) {
						var layer = cb.value;
						try {
							if (map.getLayer(layer)) map.setLayoutProperty(layer, 'visibility', 'none');
						} catch (e) {
							}
					});
				}
			}
			//Affiche toute les cases √† cocher √† z√©ro et masque les couches correspondantes sur la carte de sorte que lors du clic sur "Reset", les cases se vident et les couches disparaissent sur la carte.

			// Appeler au chargement et apr√®s un court d√©lai (au cas o√π les layers soient ajout√©s plus tard)
			window.addEventListener('load', function() {
				resetCheckboxes();
				setTimeout(resetCheckboxes, 600);
			});

}

// Appeler la fonction au chargement initial de la carte
map.on('load', function() {
	addAllLayers();
});

	</script>

</section>
	</main>
	
	

	<footer>
		<a href="mailto:lilian.baumel@univ-amu.fr">Baumel Lilian</a>
	</footer>
</body>
</html>